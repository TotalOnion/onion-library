{# Do not edit this file outside of the component library as your changes will be lost with future updates. #}
{% set treat = get_post(fields.treat) %}

{% set treat_recipe_ingredients = treat.get_field('treat_recipe_ingredients') %}

{% set unique_measurement_units = [] %}
{% for ingredients in treat_recipe_ingredients %}
	{% set default_unit = ingredients.default_unit|ru %}
	{% if(default_unit != "custom") %}
		{% if default_unit not in unique_measurement_units %}
			{% set unique_measurement_units = unique_measurement_units|merge([default_unit]) %}
		{% endif %}
		{% else %}
		{# set unique_measurement_units = unique_measurement_units|merge([default_unit]) #}
	{% endif %}

	{% for conversion_options in ingredients.conversion_options %}
		{% set co = conversion_options|ru %}
		{% if co not in unique_measurement_units and co != "none" %}
			{% set unique_measurement_units = unique_measurement_units|merge([co]) %}
		{% endif %}
	{% endfor %}
{% endfor %}

<div class="treat-info__treat-recipe-ingredients ingredients-tabs-wrapper">
	<div class="ingredients-tabs-content-title">{{fields.recipe_ingredients_title_text_info}}</div>

	<div class="ingredients-tabs-inner-wrap">
		{% for ingredients in unique_measurement_units %}
			{% if loop.index == 1 %}
				<input class="ingredients-radio" id="ingredients-tab{{loop.index}}" type="radio" name="pct" checked="checked"/>
			{% else %}
				<input class="ingredients-radio" id="ingredients-tab{{loop.index}}" type="radio" name="pct"/>
			{% endif %}
		{% endfor %}
		<nav class="ingredients-tabs">
			<ul class="ingredients-tabs-ul">
				{% for unit in unique_measurement_units %}
					<li class="ingredients-tab{{loop.index}} ingredients-tab-li">
						<label for="ingredients-tab{{loop.index}}" class="ingredients-tabs-lbl">{{unit|upper}}</label>
					</li>
				{% endfor %}
			</ul>
		</nav>
		<section class="ingredients-tab-content-wrapper">
			{% for unit in unique_measurement_units %}
				<div class="ingredients-tab{{loop.index}} content">
					{% for ingredients in treat_recipe_ingredients %}
						<p class="ingredients-tab-content">
							{% set conversion_info = attribute(ingredients, 'conversion_' ~ unit) %}
							{% set conversion_method = attribute(conversion_info, unit ~ '_conversion_style') %}
							{% set conversion_val = attribute(conversion_info, unit ~ '_converted_value') %}

							{% set amount = '' %}
							{% if ingredients.default_unit|ru == unit or (ingredients.default_unit|ru == 'custom' and ingredients.amount is not null) %}
								{% set amount = ingredients.amount %}
							{% else %}
								{% if(conversion_method|ru == 'auto') %}
									{# code for auto conversion #}
								{% else %}
									{% set amount = conversion_val %}
								{% endif %}
							{% endif %}

							<span class="ingredient-measure-unit">
								{{amount}}
								{{((ingredients.default_unit|ru == 'custom') ? ingredients.custom_unit_info.custom_unit_label : (unit == 'parts' and amount == 1 ? 'part' : unit))}}</span>
							{% if ingredients.link != false %}
								{% set ingredientLink = get_post(ingredients.link.ID) %}
								<a href="{{ingredientLink.link}}" class="ingredient-entity-link">{{ingredients.name}}</a>
							{% else %}
								{{ingredients.name}}
							{% endif %}
							{% if ingredients.notes != false %}
								{{ingredients.notes}}
							{% endif %}
						</p>
					{% endfor %}
				</div>
			{% endfor %}
		</section>
	</div>
</div>
