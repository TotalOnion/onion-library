{# Do not edit this file outside of the component library as your changes will be lost with future updates. #}
{% set gridLayoutElement = include('components/grid-layout-element.twig', { fields: field, block: block }, with_context = false) %}

{% set cocktailRecipeIngredients = post.meta('cocktail_recipe_ingredients') %}
{% set servesControlPositionMobile = '--serves-control-position-mobile: ' ~ post.serves_control_position_mobile|ru ~ ';' %}
{% set servesControlPositionPortrait = '--serves-control-position-portrait: ' ~ post.serves_control_position_portrait|ru ~ ';' %}
{% set servesControlPositionDesktop = '--serves-control-position-desktop: ' ~ post.serves_control_position_desktop|ru ~ ';' %}
{% set elementStyles = gridLayoutElement ~ servesControlPositionMobile ~ servesControlPositionPortrait ~ servesControlPositionDesktop %}

{% set uniqueMeasurementUnits = [] %}
{% set allCustomUnits = false %}
{% set customUnitsCount = 0 %}
{% set totalIngredientsCount = cocktailRecipeIngredients|length %}
{% for ingredients in cocktailRecipeIngredients %}
	{% set defaultUnit = ingredients.default_unit|ru %}
	{% if(defaultUnit != "custom") %}
		{% if defaultUnit not in uniqueMeasurementUnits %}
			{% set uniqueMeasurementUnits = uniqueMeasurementUnits|merge([defaultUnit]) %}
		{% endif %}
	{% else %}
		{% if defaultUnit == "custom" %}
			{% set customUnitsCount = ( customUnitsCount | default(0) ) + 1 %}
			{# set uniqueMeasurementUnits = uniqueMeasurementUnits|merge([defaultUnit]) #}
		{% endif %}
	{% endif %}

	{% for conversionOptions in ingredients.conversion_options %}
		{% set co = conversionOptions|ru %}
		{% if co not in uniqueMeasurementUnits and co != "none" %}
			{% set uniqueMeasurementUnits = uniqueMeasurementUnits|merge([co]) %}
		{% endif %}
	{% endfor %}
{% endfor %}

{% if totalIngredientsCount == customUnitsCount %}
	{% set allCustomUnits = true %}
	{% set allCustomUnitsClass = "all-custom-content" %}
{% endif %}

{% set partsTabOrder = post.meta('parts_tab_order') %}
{% set mlTabOrder = post.meta('ml_tab_order') %}
{% set clTabOrder = post.meta('cl_tab_order') %}
{% set ozTabOrder = post.meta('oz_tab_order') %}

{% set defaultIndex = '' %}
{% if partsTabOrder == 1 %}
	{% set defaultIndex = 'parts' %}
{% elseif mlTabOrder == 1 %}
	{% set defaultIndex = 'ml' %}
{% elseif clTabOrder == 1 %}
	{% set defaultIndex = 'cl' %}
{% elseif ozTabOrder == 1 %}
	{% set defaultIndex = 'oz' %}
{% endif %}
<style>
	.{{blockClassName}}__cocktail-recipe-ingredients.{{block.id}} {
		{{elementStyles}}
	}
</style>
<div class="{{blockClassName}}__cocktail-recipe-ingredients ingredients-tabs-outer-wrap {{blockClassName}}__info-item {{block.id}}">
	<div class="ingredients-tabs-inner-wrap">
		{% if allCustomUnits == false %}
			{% for ingredients in uniqueMeasurementUnits %}
				<input class="ingredients-radio" id="ingredients-tab{{loop.index}}" type="radio" name="pct" {% if defaultIndex is not empty and defaultIndex == ingredients %} checked="checked" {% elseif loop.index == 1 %} checked="checked" {% endif %}/>
			{% endfor %}
			<nav class="ingredients-tabs">
				<ul class="ingredients-tabs-ul">
					{% for unit in uniqueMeasurementUnits %}
						{% set tabOrder = 1 %}
						{% if partsTabOrder is not empty and unit == 'parts' %}
							{% set tabOrder = partsTabOrder %}
						{% endif %}
						{% if mlTabOrder is not empty and unit == 'ml' %}
							{% set tabOrder = mlTabOrder %}
						{% endif %}
						{% if clTabOrder is not empty and unit == 'cl' %}
							{% set tabOrder = clTabOrder %}
						{% endif %}
						{% if ozTabOrder is not empty and unit == 'oz' %}
							{% set tabOrder = ozTabOrder %}
						{% endif %}
						<li class="ingredients-tab{{loop.index}} ingredients-tab-li" style="order: {{tabOrder}}">
							<label for="ingredients-tab{{loop.index}}" class="ingredients-tabs-lbl">{{unit|upper}}</label>
						</li>
					{% endfor %}
				</ul>
			</nav>
		{% endif %}
		<section class="ingredients-tab-content-wrapper">
			{% if post.enable_serves %}
				<div class="ingredients-serve-control">
					<button class="minus-button serve-button" disabled>-</button>
					<span class="serves-display">1 SERVE</span>
					<button class="plus-button serve-button">+</button>
				</div>
			{% endif %}
			{% for unit in uniqueMeasurementUnits %}
				<div class="ingredients-tab{{loop.index}} content {{allCustomUnitsClass}}">
					{% for ingredients in cocktailRecipeIngredients %}
						{% set conversionInfo = attribute(ingredients, 'conversion_' ~ unit) %}
						{% set conversion_method = attribute(conversionInfo, unit ~ '_conversion_style') %}
						{% set conversion_val = attribute(conversionInfo, unit ~ '_converted_value') %}
						{% set link_type = ingredients.link_type|ru %}
						{% set amount = '' %}
						
						{% if ingredients.default_unit|ru == unit or (ingredients.default_unit|ru == 'custom' and ingredients.amount is not null) %}
							{% set amount = ingredients.amount %}
						{% else %}
							{% if(conversion_method|ru == 'auto') %}
								{# code for auto conversion #}
							{% else %}
								{% set amount = conversion_val %}
							{% endif %}
						{% endif %}
						<p class="ingredients-tab-content" data-base-amount="{{amount}}" data-unit="{{unit}}">
							<span class="ingredient-measure-unit">
								{{amount}}
								{{((ingredients.default_unit|ru == 'custom') ? ingredients.custom_unit_info.custom_unit_label : (unit == 'parts' and amount == 1 ? 'part' : unit))}}</span>
							{% if ingredients.link != false and link_type == 'internal' %}
								{% set ingredientLink = get_post(ingredients.link.ID) %}
								<a href="{{ingredientLink.link}}" class="ingredient-entity-link">{{ingredients.name}}</a>
							{% elseif ingredients.external_link != false and link_type == 'external' %}
								<a href="{{ingredients.external_link}}" class="ingredient-entity-link">{{ingredients.name}}</a>
							{% else %}
								{{ingredients.name}}
							{% endif %}
							{% if ingredients.notes != false %}
								{{ingredients.notes}}
							{% endif %}
						</p>
					{% endfor %}
				</div>
			{% endfor %}
		</section>
	</div>
</div>
