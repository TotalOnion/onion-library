
{% set blockClassName = "sticky-buy-cta-v3" %}
{% set classNameEntryPoint = include('entry-points/entry-point-classes.twig', { fields: fields, block: block }, with_context = false) %}
{% set htmlEntryPoint = include('entry-points/entry-point-html-v3.twig', { fields: fields, block: block, blockClassName, blockClassName }, with_context = false) %}
{% set dataAttributeEntryPoint = include('entry-points/entry-point-data-attribute.twig', { fields: fields, block: block }, with_context = false) %}
{% set styleEntryPoint = include('entry-points/entry-point-style.twig', { fields: fields, block: block, is_preview }, with_context = false) %}
{% set previewEntryPoint = include('entry-points/entry-point-preview-info.twig', { fields, block, displaytype, is_preview }, with_context = false) %}

{% set postObject = current_post %}

{% set sectionStyles =  styleEntryPoint %}

{{previewEntryPoint}}
<style>
	.{{blockClassName}}.{{block.id}}{
		{{sectionStyles}}
	}
</style>
<section {{block.anchor ? "id=" ~ block.anchor : ''}} class="{{blockClassName}} {{block.className}} {{classNameEntryPoint}} {{block.id}} lazy-fade" {{dataAttributeEntryPoint}} data-blockid="{{block.id}}" data-assetkey="{{blockClassName}}">
	
	{% if fields.enable_buy_button %}

			{% if fields.cta_style|ru matches '/^\\d+$/' %}
				{% set ctaData = attribute(cta_styles['theme_cta_styles'], fields.cta_style|ru - 1) %}
				{% set enableCtaAnimation = ctaData.cta_settings.enable_cta_animation %}
				{% set enableCtaIcon = ctaData.cta_settings.include_cta_icon %}
				{% set ctaAnimationStyle = ctaData.cta_settings.cta_animation_style %}
			{% endif %}

		{% if postObject.meta.buy_now_option_select is defined and postObject.meta.buy_now_option_select|remove_underscore == 'ctb' %}

			{% if current_post.id is defined and current_post.id is not empty %}
				<div class="sticky-buy-cta-v3__cta-wrapper">
					{% apply shortcodes %}
						[clicktobuy class="sticky-buy-cta-v3__cta-button cmpl-cta-style-{{fields.cta_style}} cmpl-cta-animation-style-{{enableCtaAnimation ? ctaAnimationStyle : '1'}} has-shop shop-ctb" lang="{{ postObject.meta('click_to_buy_language') }}" variant="{{ postObject.meta('click_to_buy_pim_id') }}" country="{{ postObject.meta('click_to_buy_country') }}" customQueryString="{{ postObject.meta('click_to_buy_custom_query_string') }}"]
							<span class="cmpl-cta-span">{{ fields.cta_text }}</span>
						[/clicktobuy]
					{% endapply %}
				</div>
			{% endif %}

			{% elseif postObject.meta.buy_now_option_select is defined and postObject.meta.buy_now_option_select|remove_underscore == 'shopify' %}

				{# <div class="sticky-buy-cta-v3__cta-wrapper">
					{% if postObject.meta.buy_now_shopify.pim is defined %}
						{% set label = (postObject.meta.cta_button_text is defined and postObject.meta.cta_button_text|remove_underscore == 'pre-order')
							? __( 'Pre-Order', 'The Glenlivet Theme' )
							: __( 'Add To Cart', 'The Glenlivet Theme' )
						%}

						<div class="buy-now-wrapper shopify-integration has-shop shop-shopify has-price" data-pim="{{ postObject.meta.buy_now_shopify.pim }}" data-label="{{ label }}"
							{% if postObject.meta.buy_now_price is defined and postObject.meta.buy_now_price is not empty %}
								data-price="{{ postObject.meta.buy_now_price }} {{ postObject.meta.currency }}"
							{% endif %}>
						</div>
					{% endif %}

					{% if postObject.meta.buy_now_shopify.engraved_bottle == true and postObject.meta.buy_now_shopify.engraved_pim is not empty %}

						<div class="buy-now-wrapper shopify-integration has-shop shop-shopify has-price engraved" data-pim="{{ postObject.meta.buy_now_shopify__engraved_pim }}" data-engraved="{{true}}" data-label="{{ __( 'Buy Engraved', 'The Glenlivet Theme' ) }}" 
							{% if postObject.meta.buy_now_shopify.engraved_price is defined and postObject.meta.buy_now_shopify.engraved_price is not empty %}
								data-price="{{ postObject.meta.buy_now_shopify.engraved_price }} {{ postObject.meta.currency }}"
							{% endif %}>
						</div>
					{% endif %}
				</div> #}

			{% elseif postObject.meta.buy_now_option_select is defined and postObject.meta.buy_now_option_select|remove_underscore == 'link' %}

				<div class="sticky-buy-cta-v3__cta-wrapper">
					<a href="{{ postObject.meta('direct_link').url }}" class="sticky-buy-cta-v3__direct-link cmpl-cta-style-{{fields.cta_style}} cmpl-cta-animation-style-{{enableCtaAnimation ? ctaAnimationStyle : '1'}}" 
						target="{{ postObject.meta('direct_link').target }}">
							<span class="cmpl-cta-span">{{ fields.cta_text }}</span>
					</a>
				</div>
				
			{% elseif gtp_language_code() == 'en-us' and postObject.meta.buy_now_option_select|remove_underscore == 'pr_usa_reservebar' %}

				<div class="sticky-buy-cta-v3__rb-wrapper">
					<h3 class="sticky-buy-cta-v3__rb-title">{{ __( 'Enter delivery address to check online availability', 'The Glenlivet Theme' ) }}</h3>
					<div liquid-address-typeahead></div>
					<div liquid-id="GROUPING-{{ postObject.meta('reserve_bar_liquid_grouping_id') }}">
						<div class="sticky-buy-cta-v3__rb-fulfillment" liquid-fulfillment-method-selector></div>
						<div class="sticky-buy-cta-v3__rb-button" liquid-atc onclick="liquidSDK.cart.toggle();"></div>
					</div>
				</div>

		{% endif %}
{% endif %}
	
	{{htmlEntryPoint}}
</section>