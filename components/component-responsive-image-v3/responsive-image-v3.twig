{% if fields.enable_image|default(fields.image_enabled) %}

	{% set desktopImage = get_image(fields.desktop_image) %}
	{% set tabletImage = get_image(fields.tablet_image)|default(desktopImage) %}
	{% set mobileImage = get_image(fields.mobile_image) %}

	{% set renderDynamic = fields.child_patterns.render_dynamic|default(0) %}
	{% set suffix = fields.child_patterns.suffix %}

	{% set selectedAspectRatioDesktop = fields.desktop_custom_aspect_ratio|default(desktopImage.width ~ '/' ~ desktopImage.height)|replace({'/' : 'x', ':' : 'x'}) %}
	{% set selectedAspectRatioTablet = fields.tablet_custom_aspect_ratio|default(desktopImage.width ~ '/' ~ desktopImage.height)|replace({'/' : 'x', ':' : 'x'}) %}
	{% set selectedAspectRatioMobile = fields.mobile_custom_aspect_ratio|default(desktopImage.width ~ '/' ~ desktopImage.height)|replace({'/' : 'x', ':' : 'x'}) %}

	{% set imageSizes = fields.custom_image_sizes %}
	{% set sizes = imageSizes|default('auto, (min-width: 1440px) 100vw, (min-width: 1024px) 1024px, (min-width: 768px) 768px, (min-width: 500px) 100vw, 250px') %}

	{% set imageFitStyle = '--image-fit-style:' ~ (fields.image_fit_style|ru|default('cover')) ~ ';' %}
	{% set imageObjectPositionAlign = '--image-object-position-align:' ~ (fields.image_object_position_align|ru) ~ ';' %}
	{% set imageWidth = '--image-width:' ~ fields.image_width|default(100) ~ '%;' %}
	{% set imageWidthMobile = '--image-width-mobile:' ~ fields.image_width_mobile|default(100) ~ '%;' %}
	{% set imageWidthPortrait = '--image-width-portrait:' ~ fields.image_width_portrait|default(100) ~ '%;' %}
	{% set imageOpacity = '--image-opacity:' ~ fields.image_opacity|default(1) ~ ';' %}
	{% set imageZIndex = '--image-z-index:' ~ fields.image_z_index|default(0) ~ ';' %}
	{% set imagePosition = '--image-position:' ~ fields.image_position|ru ~ ';' %}
	{% set imageGridArea = '--image-grid-area:' ~ fields.image_grid_area|ru|default('main') ~ ';' %}
	{% set imageBorderRadius = '--image-border-radius:' ~ fields.image_border_radius ~ ';' %}
	{% set imageOffsetVert = '--image-offset-vert:' ~ fields.image_offset_vertical ~ '%;' %}
	{% set imageOffsetHoriz = '--image-offset-horiz:' ~ fields.image_offset_horizontal ~ '%;' %}
	{% set enableImageBorder = fields.enable_image_border %}
	{% if enableImageBorder %}
		{% set imageBorderColour = '--image-border-colour:' ~ (fields.image_border_colour|ru|default(000)) ~ ';' %}
		{% set imageBorderWidth = '--image-border-width:' ~ (fields.image_border_width|ru|default(1)) ~ ';' %}
		{% set imageBorderStyle = '--image-border-style:' ~ (fields.image_border_style|ru|default('solid')) ~ ';' %}
	{% endif %}
	{% set imageMinHeightMobile = '--image-min-height-mobile:' ~ (fields.image_min_height_mobile|ru|default('auto')) ~ ';' %}
	{% set imageMinHeightDesktop = '--image-min-height-desktop:' ~ (fields.image_min_height_desktop|ru|default('auto')) ~ ';' %}
	{% set subtractHeaderHeight = '--cancel-header-height:' ~ (fields.subtract_header_height ? '0px' : 'var(--global-site-header-height, 0px)') ~ ';' %}
	{% set imageBorderString = imageBorderColour ~ imageBorderWidth ~ imageBorderStyle %}
	{% set pictureStylesString = imageFitStyle ~ imageObjectPositionAlign ~ imageWidth ~ imageWidthMobile ~ imageWidthPortrait ~ imageOpacity ~ imageAspectRatioDesktop ~ imageAspectRatioPortrait ~ imageAspectRatioMobile ~ imageOffsetVert ~ imageOffsetHoriz ~ imageBorderRadius ~ imagePosition ~ imageGridArea ~ imageMinHeightMobile ~ imageMinHeightDesktop ~ subtractHeaderHeight ~ imageZIndex %}
	{% set enableEagerLoading = fields.enable_eager_image_loading ? 'loading="eager" fetchpriority="high"' : 'loading="lazy"' %}

	{% set parallaxEnabled = fields.parallax_enabled %}
	{% if parallaxEnabled %}
		{% set parallaxDepth = 'data-depth=' ~ fields.parallax_depth ~ " " %}
		{% set parallaxOffsetY = 'data-y-offset=' ~ fields.parallax_offset_y ~ " " %}
	{% endif %}
	{% set picture_id = block.id %}

	<style>
		.single-responsive-image-v3__picture.{{picture_id|default(block.id)}}{
			{{pictureStylesString}}
			{{imageBorderString}}
			--image-aspect-ratio-desktop: {{selectedAspectRatioDesktop|replace({'x': '/'})}}
			;
			--image-aspect-ratio-portrait: {{selectedAspectRatioTablet|replace({'x': '/'})}}
			;
			--image-aspect-ratio-mobile: {{selectedAspectRatioMobile|replace({'x': '/'})}}
			;
		}
	</style>

	<!--pattern-replace-var:selectedAspectRatioDesktop={{selectedAspectRatioDesktop}}-->
	<!--pattern-replace-var:selectedAspectRatioTablet={{selectedAspectRatioTablet}}-->
	<!--pattern-replace-var:selectedAspectRatioMobile={{selectedAspectRatioMobile}}-->
	<!--pattern-replace-var:sizes={{sizes}}-->
	<!--pattern-replace-var:picture_id={{picture_id}}-->

	<!--pattern-include-start:components/responsive-picture-element-v3-->
{{ include('components/responsive-picture-element-v3.twig') }}
	<!--pattern-include-end:components/responsive-picture-element-v3-->
{% endif %}
